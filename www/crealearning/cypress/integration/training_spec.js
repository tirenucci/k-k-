describe('Test sur les module', function() {
    beforeEach(function() {
        cy.clearCookies()
        cy.clearLocalStorage()
        cy.wait(1000)
        cy.visit('/connection')
        cy.wait(1000)
        cy.get('.input__mail')
            .type('admin@logipro.com')
            .should('have.value', 'admin@logipro.com')
        cy.get('.input__pswd')
            .type('admin')
            .should('have.value', 'admin')
            cy.get('.connect__btn')
            .click({force: true})
        cy.wait(2000)
    })

    it ('Generation HTML', function(){
        cy.contains('mes modules de formation')
            .click({force: true})
        cy.contains('Bien débuter')
            .click({force: true})
        cy.get('.cle-block-title').should('exist')
        cy.get('.cle-block-img').should('exist')
        cy.get('.cle-block-list').should('exist')
        cy.get('hr').should('exist')
    })

    it ('Creation Grain', function(){
        cy.visit('/training/1')
        cy.wait(1000)
        cy.get('.green__btn')
            .click({force: true})
        cy.contains('2 - ').should('exist')
        cy.wait(1000)
        cy.get('#cle-block-list')
            .contains('.cle-block-list').should('not.exist')
    })

    it('Creation d\'un module', function() {
        cy.get('#add')
            .click({force: true})
        cy.get('#name')
            .type('testmodule')
            .should('have.value', 'testmodule')
        cy.get('.step__btn')
            .click({force: true})
        cy.wait(1000)
        cy.contains('Glissez/déposez un nouveau bloc ici').should('exist')
        cy.contains('Titre').should('exist')
        cy.get('.title-block')
            .dblclick('center',{force: true})
        cy.get('.cle-block-title').should('exist')
        cy.contains('Nouveau grain').should('exist')
        cy.get('#home')
            .click({force: true})
        cy.get('#list')
            .click({force: true})
        cy.contains('testmodule').should('exist')
    })
    
    it('Suppression d\'un module', function() {
        cy.get('#list')
            .click({force: true})
        cy.contains('testmodule').should('exist')
        cy.get('.btn__settings').first()
            .click({force: true})
        cy.contains('Supprimer')
            .click({force: true})
        cy.get('.delete__btn')
            .click({force: true})
        cy.wait(1000)
        cy.contains('Ok')
            .click({force: true})
        cy.contains('Le module a été supprimé.').should('exist')
    })

    it('Export scorm', function() {
        let regex = RegExp(/scorm12\/Bien_debuter\.scorm\.zip$/)
        cy.visit('/training/1/option/#exports')
        cy.wait(1000)
        cy.get('.archive-btn')
            .click({force: true})
        cy.contains('Ok', {timeout: 5000})
            .click({force: true,timeout: 5000})
    })
  })